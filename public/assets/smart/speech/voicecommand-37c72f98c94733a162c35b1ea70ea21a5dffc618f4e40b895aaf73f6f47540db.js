if(SpeechRecognition=root.SpeechRecognition||root.webkitSpeechRecognition||root.mozSpeechRecognition||root.msSpeechRecognition||root.oSpeechRecognition,SpeechRecognition&&voice_command){$.root_.on("click",'[data-action="voiceCommand"]',function(e){$.root_.hasClass("voice-command-active")?$.speechApp.stop():($.speechApp.start(),$("#speech-btn .popover").fadeIn(350)),e.preventDefault()}),$(document).mouseup(function(e){$("#speech-btn .popover").is(e.target)||0!==$("#speech-btn .popover").has(e.target).length||$("#speech-btn .popover").fadeOut(250)});var modal=$('<div class="modal fade" id="voiceModal" tabindex="-1" role="dialog" aria-labelledby="remoteModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"></div></div></div>');modal.appendTo("body"),debugState&&root.console.log("This browser supports Voice Command"),$.speechApp=function(e){return e.start=function(){smartSpeechRecognition.addCommands(commands),smartSpeechRecognition?(smartSpeechRecognition.start(),$.root_.addClass("voice-command-active"),$.speechApp.playON(),voice_localStorage&&localStorage.setItem("sm-setautovoice","true")):alert("speech plugin not loaded")},e.stop=function(){smartSpeechRecognition&&(smartSpeechRecognition.abort(),$.root_.removeClass("voice-command-active"),$.speechApp.playOFF(),voice_localStorage&&localStorage.setItem("sm-setautovoice","false"),$("#speech-btn .popover").is(":visible")&&$("#speech-btn .popover").fadeOut(250))},e.playON=function(){var e=document.createElement("audio");navigator.userAgent.match("Firefox/")?e.setAttribute("src",$.sound_path+"voice_on.ogg"):e.setAttribute("src",$.sound_path+"voice_on.mp3"),e.addEventListener("load",function(){e.play()},!0),$.sound_on&&(e.pause(),e.play())},e.playOFF=function(){var e=document.createElement("audio");navigator.userAgent.match("Firefox/")?e.setAttribute("src",$.sound_path+"voice_off.ogg"):e.setAttribute("src",$.sound_path+"voice_off.mp3"),$.get(),e.addEventListener("load",function(){e.play()},!0),$.sound_on&&(e.pause(),e.play())},e.playConfirmation=function(){var e=document.createElement("audio");navigator.userAgent.match("Firefox/")?e.setAttribute("src",$.sound_path+"voice_alert.ogg"):e.setAttribute("src",$.sound_path+"voice_alert.mp3"),$.get(),e.addEventListener("load",function(){e.play()},!0),$.sound_on&&(e.pause(),e.play())},e}({})}else $("#speech-btn").addClass("display-none");/*
 * SPEECH RECOGNITION ENGINE
 * Copyright (c) 2013 Tal Ater
 * Modified by MyOrange
 * All modifications made are hereby copyright (c) 2014 MyOrange
 */
(function(e){"use strict";if(!SpeechRecognition)return root.smartSpeechRecognition=null,e;var o,t,n=[],a={start:[],error:[],end:[],result:[],resultMatch:[],resultNoMatch:[],errorNetwork:[],errorPermissionBlocked:[],errorPermissionDenied:[]},r=0,c=/\s*\((.*?)\)\s*/g,i=/(\(\?:[^)]+\))\?/g,s=/(\(\?)?:\w+/g,l=/\*\w+/g,d=/[\-{}\[\]+?.,\\\^$|#]/g,u=function(e){return e=e.replace(d,"\\$&").replace(c,"(?:$1)?").replace(s,function(e,o){return o?e:"([^\\s]+)"}).replace(l,"(.*?)").replace(i,"\\s*$1?\\s*"),new RegExp("^"+e+"$","i")},p=function(e){e.forEach(function(e){e.callback.apply(e.context)})},m=function(){g()||root.smartSpeechRecognition.init({},!1)},g=function(){return o!==e};root.smartSpeechRecognition={init:function(c,i){i=i===e?!0:!!i,o&&o.abort&&o.abort(),o=new SpeechRecognition,o.maxAlternatives=5,o.continuous=!0,o.lang=voice_command_lang||"en-US",o.onstart=function(){p(a.start),debugState&&(root.console.log("%c \u2714 SUCCESS: User allowed access the microphone service to start ",debugStyle_success),root.console.log("Language setting is set to: "+o.lang,debugStyle)),$.root_.removeClass("service-not-allowed"),$.root_.addClass("service-allowed")},o.onerror=function(e){switch(p(a.error),e.error){case"network":p(a.errorNetwork);break;case"not-allowed":case"service-not-allowed":t=!1,$.root_.removeClass("service-allowed"),$.root_.addClass("service-not-allowed"),debugState&&root.console.log("%c WARNING: Microphone was not detected (either user denied access or it is not installed properly) ",debugStyle_warning),p((new Date).getTime()-r<200?a.errorPermissionBlocked:a.errorPermissionDenied)}},o.onend=function(){if(p(a.end),t){var e=(new Date).getTime()-r;1e3>e?setTimeout(root.smartSpeechRecognition.start,1e3-e):root.smartSpeechRecognition.start()}},o.onresult=function(e){p(a.result);for(var o,t=e.results[e.resultIndex],r=0;r<t.length;r++){o=t[r].transcript.trim(),debugState&&root.console.log("Speech recognized: %c"+o,debugStyle);for(var c=0,i=n.length;i>c;c++){var s=n[c].command.exec(o);if(s){var l=s.slice(1);debugState&&(root.console.log("command matched: %c"+n[c].originalPhrase,debugStyle),l.length&&root.console.log("with parameters",l)),n[c].callback.apply(this,l),p(a.resultMatch);var d=["sound on","mute","stop"];return d.indexOf(n[c].originalPhrase)<0&&($.smallBox({title:n[c].originalPhrase,content:"loading...",color:"#333",sound_file:"voice_alert",timeout:2e3}),$("#speech-btn .popover").is(":visible")&&$("#speech-btn .popover").fadeOut(250)),!0}}}return p(a.resultNoMatch),$.smallBox({title:'Error: <strong> " '+o+' " </strong> no match found!',content:"Please speak clearly into the microphone",color:"#a90329",timeout:5e3,icon:"fa fa-microphone"}),$("#speech-btn .popover").is(":visible")&&$("#speech-btn .popover").fadeOut(250),!1},i&&(n=[]),c.length&&this.addCommands(c)},start:function(n){m(),n=n||{},t=n.autoRestart!==e?!!n.autoRestart:!0,r=(new Date).getTime(),o.start()},abort:function(){t=!1,g&&o.abort()},debug:function(e){arguments.length>0?debugState=!!e:debugState=!0},setLanguage:function(e){m(),o.lang=e},addCommands:function(e){var o,t;m();for(var a in e)if(e.hasOwnProperty(a)){if(o=root[e[a]]||e[a],"function"!=typeof o)continue;t=u(a),n.push({command:t,callback:o,originalPhrase:a})}debugState&&root.console.log("Commands successfully loaded: %c"+n.length,debugStyle)},removeCommands:function(o){return o===e?void(n=[]):(o=Array.isArray(o)?o:[o],void(n=n.filter(function(e){for(var t=0;t<o.length;t++)if(o[t]===e.originalPhrase)return!1;return!0})))},addCallback:function(o,t,n){if(a[o]!==e){var r=root[t]||t;"function"==typeof r&&a[o].push({callback:r,context:n||this})}}}}).call(this);var autoStart=function(){smartSpeechRecognition.addCommands(commands),smartSpeechRecognition?(smartSpeechRecognition.start(),$.root_.addClass("voice-command-active"),voice_localStorage&&localStorage.setItem("sm-setautovoice","true")):alert("speech plugin not loaded")};SpeechRecognition&&voice_command&&"true"==localStorage.getItem("sm-setautovoice")&&autoStart(),SpeechRecognition&&voice_command_auto&&voice_command&&autoStart();