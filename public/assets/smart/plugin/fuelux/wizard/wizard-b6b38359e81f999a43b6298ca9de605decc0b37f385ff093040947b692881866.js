/*
 * Fuel UX Wizard
 * https://github.com/ExactTarget/fuelux
 *
 * Copyright (c) 2012 ExactTarget
 * Licensed under the MIT license.
 */
var old=$.fn.wizard,Wizard=function(t,e){var i;this.$element=$(t),this.options=$.extend({},$.fn.wizard.defaults,e),this.options.disablePreviousStep="previous"===this.$element.data().restrict?!0:!1,this.currentStep=this.options.selectedItem.step,this.numSteps=this.$element.find(".steps li").length,this.$prevBtn=this.$element.find("button.btn-prev"),this.$nextBtn=this.$element.find("button.btn-next"),i=this.$nextBtn.children().detach(),this.nextText=$.trim(this.$nextBtn.text()),this.$nextBtn.append(i),this.$prevBtn.on("click",$.proxy(this.previous,this)),this.$nextBtn.on("click",$.proxy(this.next,this)),this.$element.on("click","li.complete",$.proxy(this.stepclicked,this)),this.currentStep>1&&this.selectedItem(this.options.selectedItem),this.options.disablePreviousStep&&(this.$prevBtn.attr("disabled",!0),this.$element.find(".steps").addClass("previous-disabled"))};Wizard.prototype={constructor:Wizard,setState:function(){var t=this.currentStep>1,e=1===this.currentStep,i=this.currentStep===this.numSteps;this.options.disablePreviousStep||this.$prevBtn.attr("disabled",e===!0||t===!1);var s=this.$nextBtn.data();if(s&&s.last&&(this.lastText=s.last,"undefined"!=typeof this.lastText)){var n=i!==!0?this.nextText:this.lastText,r=this.$nextBtn.children().detach();this.$nextBtn.text(n).append(r)}var a=this.$element.find(".steps li");a.removeClass("active").removeClass("complete"),a.find("span.badge").removeClass("badge-info").removeClass("badge-success");var d=".steps li:lt("+(this.currentStep-1)+")",h=this.$element.find(d);h.addClass("complete"),h.find("span.badge").addClass("badge-success");var l=".steps li:eq("+(this.currentStep-1)+")",p=this.$element.find(l);p.addClass("active"),p.find("span.badge").addClass("badge-info");var o=p.data().target;this.$element.next(".step-content").find(".step-pane").removeClass("active"),$(o).addClass("active"),this.$element.find(".steps").first().attr("style","margin-left: 0");var c=0;this.$element.find(".steps > li").each(function(){c+=$(this).outerWidth()});var f=0;if(f=this.$element.find(".actions").length?this.$element.width()-this.$element.find(".actions").first().outerWidth():this.$element.width(),c>f){var u=c-f;this.$element.find(".steps").first().attr("style","margin-left: -"+u+"px"),this.$element.find("li.active").first().position().left<200&&(u+=this.$element.find("li.active").first().position().left-200,1>u?this.$element.find(".steps").first().attr("style","margin-left: 0"):this.$element.find(".steps").first().attr("style","margin-left: -"+u+"px"))}this.$element.trigger("changed")},stepclicked:function(t){var e=$(t.currentTarget),i=this.$element.find(".steps li").index(e),s=!0;if(this.options.disablePreviousStep&&i<this.currentStep&&(s=!1),s){var n=$.Event("stepclick");if(this.$element.trigger(n,{step:i+1}),n.isDefaultPrevented())return;this.currentStep=i+1,this.setState()}},previous:function(){var t=this.currentStep>1;if(this.options.disablePreviousStep&&(t=!1),t){var e=$.Event("change");if(this.$element.trigger(e,{step:this.currentStep,direction:"previous"}),e.isDefaultPrevented())return;this.currentStep-=1,this.setState()}},next:function(){var t=this.currentStep+1<=this.numSteps,e=this.currentStep===this.numSteps;if(t){var i=$.Event("change");if(this.$element.trigger(i,{step:this.currentStep,direction:"next"}),i.isDefaultPrevented())return;this.currentStep+=1,this.setState()}else e&&this.$element.trigger("finished")},selectedItem:function(t){var e,i;return t?(i=t.step||-1,i>=1&&i<=this.numSteps&&(this.currentStep=i,this.setState()),e=this):e={step:this.currentStep},e}},$.fn.wizard=function(t){var e,i=Array.prototype.slice.call(arguments,1),s=this.each(function(){var s=$(this),n=s.data("wizard"),r="object"==typeof t&&t;n||s.data("wizard",n=new Wizard(this,r)),"string"==typeof t&&(e=n[t].apply(n,i))});return void 0===e?s:e},$.fn.wizard.defaults={selectedItem:{step:1}},$.fn.wizard.Constructor=Wizard,$.fn.wizard.noConflict=function(){return $.fn.wizard=old,this},$(function(){$("body").on("mouseover.wizard.data-api",".wizard",function(){var t=$(this);t.data("wizard")||t.wizard(t.data())})});